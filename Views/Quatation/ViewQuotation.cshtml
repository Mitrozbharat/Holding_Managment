
<section>
    <div class="text-center">
        <button class="btn btn-info my-4 mb-2 ms-4" id="exportToPPT">Export to PPT</button>
        <button class="btn btn-info my-4 mb-2 ms-4" id="exportToPDF">Export to PDF</button>
    </div>

    <div id="exportContent" class="card p-4 m-2">
        <div class="container-fluid my-2">
            <div class="mb-3">
                <div class="row">

                    <div class="col-lg-6 text-center">
                        <img id="myImage" class="m-3" alt="Location Image" style="width:100%; max-width: 350px" />
                        <span id="imagedata" style="display:none"></span>
                        <img id="myImagetwo" class="m-3" alt="Location Image" style="display:none" />
                        <span id="imagedatatwo" style="display:none"></span>
                    </div>


                    <div class="col-lg-6 text-lg-right pr-4">
                        <div class="text-end">
                            <h1 class="display-4 text-end">SAHU ADVERTISING</h1>
                            <p class="lead">Office No. 307, Supreme Classic Building,<br /> Salunke Vihar Road, Pune 411048</p>
                            <p>Email: <a href="mailto:marketing@sahuads.com">marketing@sahuads.com</a><br /> GSTIN: 27ABJCS1061L1Z3</p>
                        </div>
                    </div>
                </div>
                @if (Model != null)
                {
                    var totalprice = 0.0;
                    <h4 class="text-center my-4">Quotation Details</h4>
                    <div class="row">
                        <div class="col-md-6 text-center mb-3 mb-md-0">
                            <input type="hidden" class="hidden" quotationId="@Model.Id" value="@Model.Id" />
                            <p><strong>Quotation No :</strong> @Model.QuotationNumber</p>
                            <p style="display:none"><strong>Quotation No   :</strong> @Model.QuotationNumber</p>
                            <p><strong>Date :</strong> @Model.CreatedAt?.ToString("yyyy-MM-dd")</p>
                            <p style="display:none"><strong>Date                  :</strong> @Model.CreatedAt?.ToString("yyyy-MM-dd")</p>
                        </div>
                        <div class="col-md-6 totalamountclass text-center">
                            <p><strong>Quotation For :</strong> @Model.BussnessName</p>
                            <p style="display:none"><strong>Quotation For    :</strong> @Model.BussnessName</p>
                            @foreach (var item in Model.Items)
                            {

                                totalprice += Convert.ToDouble(item.Rate);

                            }
                            <p><strong>Total  : </strong> @totalprice /-</p>
                            <p style="display:none"><strong>Total         : </strong> @totalprice /-</p>
                        </div>
                    </div>
                    <hr>
                    @foreach (var item in Model.Items)
                    {
                        <div class="card mt-4">
                            <div class="media my-2 flex-column flex-md-row align-items-center">
                                <img src="data:image/png;base64,@item.Image" class=" img-size m-3" alt="Location Image" style="max-height:250px; max-width:350px;">

                                <div class="media-body mt-4 text-center text-md-left">
                                    <h5 class="mt-0">@item.Location</h5>
                                    <p><strong>City:</strong> @item.City</p>
                                    <p><strong>Size:</strong> @item.Width x @item.Height</p>
                                    <p><strong>Vendor :</strong> @Model.VendorName</p>
                                    <h5 class="text-primary">Price: @item.Rate/-</h5>
                                </div>
                            </div>
                        </div>

                    }
                }

                else

                {
                    <p>No data available.</p>
                }
            </div>
        </div>
    </div>

   @* <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>*@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>



    <script>
        $(document).ready(function () {
            $("#exportToPDF").on("click", function () {
                const { jsPDF } = window.jspdf;
                let doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'in',
                    format: 'A4',
                });

                // Define the font styles
                const titleFont = { fontSize: 18, fontStyle: 'bold' };
                const textFont = { fontSize: 12 };

                // First page (Welcome slide equivalent)
                let pageWidth = doc.internal.pageSize.getWidth();
                let pageHeight = doc.internal.pageSize.getHeight();
                // Add the first image (background)
                let imgData = document.getElementById('imagedatatwo').innerHTML;
                console.log("Background Image Data:", imgData);
                doc.addImage(imgData, 'PNG', 0, 0, pageWidth, pageHeight); // Adjust as needed

                // Add the logo image (second image) on top of the first image
                let logoImgData = document.getElementById('imagedata').innerHTML;
                console.log("Logo Image Data:", logoImgData);

                // Adjust these coordinates to position the logo
                let logoX = 9.2; // X position
                let logoY = 0.3; // Y position
                let logoWidth = 1.5; // Width of the logo
                let logoHeight = 0.5; // Height of the logo

                // Add the logo image
                doc.addImage(logoImgData, 'PNG', logoX, logoY, logoWidth, logoHeight);
                doc.setFontSize(25);
                doc.setFont("helvetica", "bold");

                // Set the color for the main text (default black)
                doc.setTextColor(0, 0, 0); // RGB for black
                doc.text('Hoarding Document', pageWidth - 0.3, pageHeight / 1.1, { align: 'right' });
              
                  doc.setFontSize(35);
                // Set the color for the "|" character (red)
                doc.setTextColor(255, 0, 0); // RGB for red
                doc.text('|', pageWidth - 0.15, pageHeight / 1.1, { align: 'right' }); // Adjust position slightly

                // Reset text color back to default if needed
                doc.setTextColor(0, 0, 0); // Reset to black for any further text


                // Add a new page for Quotation Details
                doc.addPage();
                doc.setFillColor(255, 238, 240); // Light red background
                doc.rect(0, 0, pageWidth, pageHeight, 'F');

                doc.addImage(logoImgData, 'PNG', 1.7, 2.1, 2, 1);

                doc.setFontSize(16);
                doc.setTextColor(255, 0, 0); // Red
                doc.text('SAHU OUTDOOR ADVERTISING', pageWidth/1.2, 2.2, { align: 'right' });
                doc.setTextColor(128, 128, 128); // Gray
                doc.setFontSize(12);
                doc.text('Office No. 307, Supreme Classic Building,',pageWidth/ 1.2, 2.5, { align: 'right' });
                doc.text('Salunke Vihar Road, Pune 411048',pageWidth/ 1.2, 2.7, { align: 'right' });
                doc.text('Email: marketing@sahuads.com GSTIN: 27ABJCS1061L1Z3',pageWidth/ 1.2, 2.9, { align: 'right' });
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont("helvetica", "bold");
                doc.text('Quotation Details', pageWidth / 2, 4.0, { align: 'center' });

                // Add quotation details
                let quotationId = $('#exportContent').find("input[quotationId]").val();
                let date = $('.col-md-6 p').eq(1).text();
                let dateone = $('.col-md-6 p').eq(3).text();
                let customer = $('.totalamountclass p').eq(1).text();
                let totalPrice = $('.totalamountclass p').eq(3).text();
                // Set up padding and background dimensions
                const backgroundX = 1.8; // X position of the background
                const backgroundY = 4.9; // Y position of the background
                const backgroundWidth = 8; // Width of the background
                const backgroundHeight = 2; // Height of the background
                const cornerRadius = 0.2;

                // Set the background color
                doc.setFillColor(255, 255, 255); // White background for the text area
              //  doc.rect(backgroundX, backgroundY, backgroundWidth, backgroundHeight, cornerRadius, 'F'); // Fill the rectangle
                doc.roundedRect(backgroundX, backgroundY, backgroundWidth, backgroundHeight, cornerRadius, cornerRadius, 'F'); // Fill the rounded rectangle

                // Add text with padding
                doc.setFontSize(14);
                doc.text(`${date}`, 2.5, 5.6);
                doc.text(`${dateone}`, 2.5, 6.1);
                doc.text(`${customer}`, 6.5, 5.6);
                doc.text(`${totalPrice}`, 6.5, 6.1);



                // Loop through items and add them to the PDF
                let totalQuote = 0;
                let countforslide = 0;
                let totalitemofthequation = 0;

                $('.card.mt-4').each(function (index, element) {
                    totalitemofthequation += 1;
                });

                $('.card.mt-4').each(function (index, element) {
                    if (countforslide % 2 === 0) {
                        doc.addPage();
                        doc.setFillColor(255, 238, 240);
                        doc.rect(0, 0, pageWidth, pageHeight, 'F');
                    }

                    let itemLocation = $(this).find('.media-body h5').eq(0).text();
                    let itemCity = $(this).find('p').eq(0).text().replace('City:', '').trim();
                    let itemSize = $(this).find('p').eq(1).text().replace('Size:', '').trim();
                    let itemVendor = $(this).find('p').eq(2).text().replace('Vendor Name:', '').trim();
                    let itemRate = $(this).find('.text-primary').text().replace('Price:', '').trim();
                    let itemImage = $(this).find('img').attr('src').split(',')[1];

                    totalQuote += parseFloat(itemRate.replace(/,/g, '')) || 0;

                    let yPosition = (countforslide % 2 === 0) ? 0.5 : 3;
                    const backgroundX = 1.7; // X position of the background
                    const backgroundY = (countforslide % 2 === 0) ? 1.4 : 4.1; // Y position of the background
                    const backgroundWidth = 8; // Width of the background
                    const backgroundHeight = 2.4; // Height of the background
                    const cornerRadius = 0.2;
                    // Set the background color
                    doc.setFillColor(255, 255, 255);
                    doc.roundedRect(backgroundX, backgroundY, backgroundWidth, backgroundHeight, cornerRadius, cornerRadius, 'F'); // Fill the rounded rectangle

                    // Add the image
                    doc.addImage(itemImage, 'PNG', 1.9, backgroundY + 0.4, 2.3, 1.6);
                    doc.text(`Location: ${itemLocation}`, 4.5, backgroundY + 0.5);
                    doc.text(`City: ${itemCity}`, 4.5, backgroundY + 1);
                    doc.text(`Size: ${itemSize}`, 4.5, backgroundY + 1.5);
                    doc.text(`Vendor: ${itemVendor}`, 4.5, backgroundY + 1.9);
                    doc.text(`Price: ${itemRate}`, 7.9, backgroundY + 1.9);

                    countforslide += 1;
                });
                const thankYouText = 'Thank you';
                const textWidth = doc.getTextWidth(thankYouText) + 2; // Get the text width and add 1 for extra space
                const minFontSize = 7;    // Adjust this value as needed
                doc.setFontSize(minFontSize); // Set the font size
                if (totalitemofthequation % 2 === 0) {
                    doc.addPage();
                    doc.setFillColor(255, 238, 240);
                    doc.rect(0, 0, pageWidth, pageHeight, 'F'); // Optional: Fill the background

                    // Draw a red line above the "Thank you" text
                    doc.setDrawColor(255, 0, 0); // Set the line color to red
                    const lineY = pageHeight / 1.3; // Adjust this value for line position
                    const lineXStart = (pageWidth - textWidth) / 2; // Center the line
                    doc.setLineWidth(0.1); // Set the line thickness
                    doc.line(lineXStart, lineY, lineXStart + textWidth, lineY); // Draw the line

                    doc.setFontSize(25);
                    doc.setTextColor(0, 0, 0);
                    doc.text(thankYouText, pageWidth / 2, pageHeight / 1.2, { align: 'center' });
                } else {
                    // Draw a red line above the "Thank you" text
                    doc.setDrawColor(255, 0, 0); // Set the line color to red
                    const lineY = pageHeight / 1.3; // Adjust this value for line position
                    const lineXStart = (pageWidth - textWidth) / 2; // Center the line
                    doc.setLineWidth(0.1); // Set the line thickness
                    doc.line(lineXStart, lineY, lineXStart + textWidth, lineY); // Draw the line
                    doc.setFontSize(25);
                    doc.setTextColor(0, 0, 0);
                    doc.text(thankYouText, pageWidth / 2, pageHeight / 1.2, { align: 'center' });
                }
                doc.save('Quotation.pdf');
            });
       
           

            function getBase64ImageFromUrl(url, callback) {
                fetch(url)
                    .then(response => response.blob())
                    .then(blob => {
                        var reader = new FileReader();
                        reader.onloadend = function () {
                            var base64String = reader.result.replace("data:", "").replace(/^.+,/, '');
                            callback(base64String);
                        };
                        reader.readAsDataURL(blob);
                    })
                    .catch(error => console.error('Error converting image:', error));
            }

            var imageUrl = window.location.origin + "/images/logo.png";
            getBase64ImageFromUrl(imageUrl, function (base64String) {
                console.log('Base64 String:', base64String);
                document.getElementById('myImage').src = "data:image/png;base64," + base64String + "";
                document.getElementById('imagedata').innerHTML = "data:image/png;base64," + base64String + "";

            });

            var imageUrl = window.location.origin + "/images/HoardingImg.png";
            getBase64ImageFromUrl(imageUrl, function (base64String) {
                console.log('Base64 String:', base64String);
                document.getElementById('myImagetwo').src = "data:image/png;base64," + base64String + "";
                document.getElementById('imagedatatwo').innerHTML = "data:image/png;base64," + base64String + "";

            });


        });
    </script>
    <script>

        $(document).ready(function () {
            $("#exportToPPT").on("click", function () {
                let pptx = new PptxGenJS();

                // Define the design template
                const titleFont = { fontSize: 32, bold: true, color: '0088CC' };
                const textFont = { fontSize: 18 };

                // Add the welcome slide
                let firstSlide = pptx.addSlide();
                firstSlide.addImage({ path: document.getElementById('imagedatatwo').innerHTML, x: 0, y: 0, w: '100%', h: '100%' });
                firstSlide.addImage({ path: document.getElementById('imagedata').innerHTML, x: 8.2, y: 0.3, w: 1.5, h: 0.5 });
                const headerTextFont = { fontSize: 23, bold: true, color: '000000' };
                firstSlide.addText('Hoarding Document', { x: 5.9, y: 4.7, w: '40%', h: 1, ...headerTextFont, align: 'right' });

                let secondSlide = pptx.addSlide();
                secondSlide.addShape(pptx.ShapeType.rect, {
                    x: 0,
                    y: 0,
                    w: '100%',
                    h: '100%',
                    fill: { color: 'FFEEF0' }
                });
                secondSlide.addImage({ path: document.getElementById('imagedata').innerHTML, x: 1.7, y: 1.1, w: 2, h: 1 });

                const headingFont = { fontSize: 14, bold: true, color: 'FF0000' }; // Red color and font size 13
                const textFontone = { fontSize: 12, color: '000000' };
                const textHeadingFont = { fontSize: 16, bold: true, color: '000000' };
                const tabletext = { fontSize: 14, color: '000000' };

                secondSlide.addText('SAHU OUTDOOR ADVERTISING', { x: 1, y: 1.2, ...headingFont, align: 'right' });
                secondSlide.addText('Office No. 307, Supreme Classic Building,', { x: 1, y: 1.5, ...textFontone, align: 'right' });
                secondSlide.addText('Salunke Vihar Road, Pune 411048', { x: 1, y: 1.7, ...textFontone, align: 'right' });
                secondSlide.addText('Email: marketing@sahuads.com GSTIN: 27ABJCS1061L1Z3', { x: 1, y: 1.9, ...textFontone, align: 'right' });

                secondSlide.addText('Quotation Details', { x: 1, y: 2.6, ...textHeadingFont, align: 'center' });

                secondSlide.addShape(pptx.ShapeType.rect, {
                    x: 1.4,
                    y: 3,
                    w: 7.5,
                    h: 1.3,
                    fill: { color: 'FFFFFF' },
                    line: { color: 'FFFFFF', width: 15 }
                });

                let quotationId = $('#exportContent').find("input[quotationId]").val();
                let date = $('.col-md-6 p').eq(1).text();
                let dateone = $('.col-md-6 p').eq(3).text();
                let customer = $('.totalamountclass p').eq(1).text();
                let totalPrice = $('.totalamountclass p').eq(3).text();

                secondSlide.addText(`${date}`, { x: 2, y: 3.5, ...tabletext, align: 'left' });
                secondSlide.addText(`${dateone}`, { x: 2, y: 3.8, ...tabletext, align: 'left' });
                secondSlide.addText(`${customer}`, { x: 5.5, y: 3.5, ...tabletext, align: 'left' });
                secondSlide.addText(`${totalPrice}`, { x: 5.5, y: 3.8, ...tabletext, align: 'left' });


                let totalQuote = 0;

                // Function to convert base64 to Blob URL
                function base64ToBlobUrl(base64, contentType) {
                    let sliceSize = 1024;
                    let byteCharacters = atob(base64);
                    let bytesLength = byteCharacters.length;
                    let sliceCount = Math.ceil(bytesLength / sliceSize);
                    let byteArrays = new Array(sliceCount);
                    for (let sliceIndex = 0; sliceIndex < sliceCount; sliceIndex++) {
                        let begin = sliceIndex * sliceSize;
                        let end = Math.min(begin + sliceSize, bytesLength);
                        let bytes = new Array(end - begin);
                        for (let offset = begin, i = 0; offset < end; ++i, ++offset) {
                            bytes[i] = byteCharacters[offset].charCodeAt(0);
                        }
                        byteArrays[sliceIndex] = new Uint8Array(bytes);
                    }
                    let blob = new Blob(byteArrays, { type: contentType });
                    return URL.createObjectURL(blob);
                }

                const itemslideloca = { fontSize: 16, bold: true, color: '000000' };
                const itemslidePrice = { fontSize: 18, bold: true, color: '000000' };
                const itemslideData = { fontSize: 16, color: '000000' };


                let itemSlide;
                let countforslide = 0;
                let totalitemofthequation = 0;

                $('.card.mt-4').each(function (index, element) {
                    totalitemofthequation += 1;
                });

                $('.card.mt-4').each(function (index, element) {
                    if (countforslide % 2 === 0) {

                        itemSlide = pptx.addSlide();


                        itemSlide.addShape(pptx.ShapeType.rect, {
                            x: 0,
                            y: 0,
                            w: '100%',
                            h: '100%',
                            fill: { color: 'FFEEF0' }
                        });
                    }

                    // Retrieve item details
                    let itemLocation = $(this).find('.media-body h5').eq(0).text();
                    let itemCity = $(this).find('p').eq(0).text().replace('City:', '').trim();
                    let itemSize = $(this).find('p').eq(1).text().replace('Size:', '').trim();
                    let itemVendor = $(this).find('p').eq(2).text().replace('Vendor Name:', '').trim();
                    let itemRate = $(this).find('.text-primary').text().replace('Price:', '').trim();
                    let itemImage = $(this).find('img').attr('src').split(',')[1];

                    totalQuote += parseFloat(itemRate.replace(/,/g, '')) || 0;

                    let yPosition = (countforslide % 2 === 0) ? 0.5 : 3;

                    // Add item details to the slide
                    itemSlide.addShape(pptx.ShapeType.rect, {
                        x: 1.2,
                        y: yPosition,
                        w: 7.8,
                        h: 1.8,
                        fill: { color: 'FFFFFF' },
                        line: { color: 'FFFFFF', width: 15 }
                    });
                    itemSlide.addImage({ path: base64ToBlobUrl(itemImage, 'image/png'), x: 1.3, y: yPosition + 0.1, w: 2.3, h: 1.6 });
                    itemSlide.addText(`Location: ${itemLocation}`, { x: 3.7, y: yPosition + 0.1, ...itemslideloca });
                    itemSlide.addText(`City         : ${itemCity}`, { x: 3.7, y: yPosition + 0.7, ...itemslideData });
                    itemSlide.addText(`Size         : ${itemSize}`, { x: 3.7, y: yPosition + 1.1, ...itemslideData });
                    itemSlide.addText(`Vendor   : ${itemVendor}`, { x: 3.7, y: yPosition + 1.5, ...itemslideData });
                    itemSlide.addText(`Price: ${itemRate}`, { x: 6.9, y: yPosition + 1.5, ...itemslidePrice });

                    // Increment the counter
                    countforslide += 1;
                });

                const titleT = { fontSize: 25, bold: true, color: '000000', fontFace: 'Arial' };

                if (totalitemofthequation % 2 === 0) {

                    // Add thank you slide
                    let lastSlide = pptx.addSlide();
                    lastSlide.addShape(pptx.ShapeType.rect, {
                        x: 0,
                        y: 0,
                        w: '100%',
                        h: '100%',
                        fill: { color: 'FFEEF0' }
                    });

                    lastSlide.addShape(pptx.ShapeType.line, {
                        x: 3.7,
                        y: 4.7,
                        w: 2.5,
                        h: 0,
                        line: { color: 'FF0000', width: 4 }
                    });

                    lastSlide.addText('Thank you', { x: 1.2, y: 5, ...titleT, align: 'center' });

                } else {


                    itemSlide.addShape(pptx.ShapeType.line, {
                        x: 3.7,
                        y: 4.7,
                        w: 2.5,
                        h: 0,
                        line: { color: 'FF0000', width: 4 }
                    });

                    itemSlide.addText('Thank you', { x: 1.2, y: 5, ...titleT, align: 'center' });
                }

                // Save the presentation
                pptx.writeFile('Quotation.pptx').then(function (fileName) {
                    console.log('Presentation saved as:', fileName);
                }).catch(function (err) {
                    console.error('Error saving presentation:', err);
                });
            });
        });

    </script>

</section>
